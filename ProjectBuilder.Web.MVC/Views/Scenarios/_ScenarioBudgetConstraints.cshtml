@{
    ViewData["Title"] = "BudgetConstraints";
}





<table class="table table-bordered table-hover table-striped" id="budgetConstraints">
    <thead class="bg-success text-white">
        <tr>
            <th>
                Bud No:
            </th>
            <th>
                @Html.DisplayName("Year of work")
            </th>
            <th>
                @Html.DisplayName("District")
            </th>
            <th>
                @Html.DisplayName("Bridge Interstate Budget ($M)")
            </th>
            <th>
                @Html.DisplayName("Bridge Non-Interstate Budget ($M)")
            </th>
            <th>
                @Html.DisplayName("Pavement Interstate Budget ($M)")
            </th>
            <th>
                @Html.DisplayName("Pavement Non-Interstate Budget ($M)")
            </th>
            <th>
                @Html.DisplayName("Actions")
            </th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<!-- Modal for editing budget values -->
<div class="modal fade" id="editBudgetModal" tabindex="-1" aria-labelledby="editBudgetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editBudgetModalLabel">Edit Budget</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="budid" class="form-control" hidden>

                <label for="editBridgeInterstateBudget">Bridge Interstate Budget($M):</label>
                <input type="text" id="editBridgeInterstateBudget" class="form-control">

                <label for="editBridgeNonInterstateBudget">Bridge Non-Interstate Budget($M):</label>
                <input type="text" id="editBridgeNonInterstateBudget" class="form-control">

                <label for="editPavementInterstateBudget">Pavement Interstate Budget($M):</label>
                <input type="text" id="editPavementInterstateBudget" class="form-control">

                <label for="editPavementNonInterstateBudget">Pavement Non-Interstate Budget($M):</label>
                <input type="text" id="editPavementNonInterstateBudget" class="form-control">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveEditedBudget()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="DeleteBudgetModal" tabindex="-1" aria-labelledby="editBudgetModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editBudgetModalLabel">Delete Budget</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <input type="text" id="budidDelete" class="form-control" hidden>

            </div>
            <div class="modal-body">
               <p>Are you sure you want to delete this budget constraint</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="deleteBudgetConfirmed()">Save changes</button>
            </div>
        </div>
    </div>
</div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script>
    // Function to handle the edit button click
    function onEditBudget() {

        var BudId = this.getAttribute('data-Bud-id');
        var row = $(this).closest('tr');
        $('#budid').val(row.find('td:eq(0)').text());
        $('#editBridgeInterstateBudget').val(row.find('td:eq(3)').text());
        $('#editBridgeNonInterstateBudget').val(row.find('td:eq(4)').text());
        $('#editPavementInterstateBudget').val(row.find('td:eq(5)').text());
        $('#editPavementNonInterstateBudget').val(row.find('td:eq(6)').text());
        // Show the modal
        // $('#editBudgetModal').modal('show');
        var model = document.getElementById('editBudgetModal');
        var formModel = bootstrap.Modal.getOrCreateInstance(model);
        formModel.show();
    }
    function saveEditedBudget() {
        // Retrieve the edited values from the modal fields
        var budid = $('#budid').val();
        var editedBridgeInterstateBudget = $('#editBridgeInterstateBudget').val();
        var editedBridgeNonInterstateBudget = $('#editBridgeNonInterstateBudget').val();
        var editedPavementInterstateBudget = $('#editPavementInterstateBudget').val();
        var editedPavementNonInterstateBudget = $('#editPavementNonInterstateBudget').val();
        // Add your logic to update the budget object or send the edited values to the server
        var row = $("#budgetConstraints tbody").find("tr").eq(budid-1);
        // Update the values in the respective cells
        row.find("td:eq(3)").text(editedBridgeInterstateBudget);
        row.find("td:eq(4)").text(editedBridgeNonInterstateBudget);
        row.find("td:eq(5)").text(editedPavementInterstateBudget);
        row.find("td:eq(6)").text(editedPavementNonInterstateBudget);
        // Close the modal
        // $('#editBudgetModal').modal('hide');
        var model = document.getElementById('editBudgetModal');
        var formModel = bootstrap.Modal.getOrCreateInstance(model);
        formModel.hide();

    }


    function confirmDelete() {
        var budId = this.getAttribute('data-Bud-id');
        console.log('Enter in delete' , budId);
        // Update modal content or message based on budId
        var modalContent = "Are you sure you want to delete budget ID " + budId + "?";
        $('#budidDelete').val(budId);

        $('#DeleteBudgetModal .modal-body').html(modalContent);

        // Show the modal
        var deleteModal = new bootstrap.Modal(document.getElementById('DeleteBudgetModal'));
        deleteModal.show();

        // Set up a listener for the delete button in the modal
        $('#confirmDeleteButton').data('Bud-id', budId);
    }
    function deleteBudgetConfirmed() {
        var budid = $('#budidDelete').val();


        // Perform the delete action
        var row = $('button[data-Bud-id="' + budid + '"]').closest('tr');
        row.remove();

        // Hide the modal
        var model = document.getElementById('DeleteBudgetModal');
        var formModel = bootstrap.Modal.getOrCreateInstance(model);
        formModel.hide();
    }
    // Example of how to use it
    // $.ajax({
    //     url: '/EditScenario/PBudgetConstraints',
    //     type: 'GET',
    //     dataType: "json",
    //     success: function (response) {
    //         var tableBody = $("#budgetConstraints tbody");
    //         var budid = 0;
    //         $.each(response, function (id, budget) {
    //             budid++;
    //             var rowHtml = "<tr>";
    //             rowHtml += "<td>" + budid + "</td>";
    //             rowHtml += "<td>" + budget.yearWork + "</td>";
    //             rowHtml += "<td>" + budget.district + "</td>";
    //             rowHtml += "<td>" + (budget.bridgeInterstateBudget / 1000000).toFixed(2) + "</td>";
    //             rowHtml += "<td>" + (budget.bridgeNonInterstateBudget / 1000000).toFixed(2) + "</td>";
    //             rowHtml += "<td>" + (budget.pavementInterstateBudget / 1000000).toFixed(2) + "</td>";
    //             rowHtml += "<td>" + (budget.pavementNonInterstateBudget / 1000000).toFixed(2) + "</td>";
    //             rowHtml += "<td><div class='dropdown'>" +
    //                 "<button class='btn btn-secondary circlebutton' " +
    //                 "type='button' id='dropdownMenuButton1' " +
    //                 "data-bs-toggle='dropdown' aria-expanded='true'>" +
    //                 "<i context-menu='' class='fa-solid fa-ellipsis-vertical'></i>" +
    //                 "</button>" +
    //                 "<ul class='dropdown-menu' aria-labelledby='dropdownMenuButton1' " +
    //                 "data-popper-placement='bottom-end' style='position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate(-134px, 32px);'>" +
    //                 "<li> " +
    //                   "<button type='button' onclick='onEditBudget.bind(this)()' data-Bud-id='" + budid + "' class='btn mb-1'>" +
    //                       "<i class='bi bi-pencil-square'></i> Edit" +
    //                   "</button>" + " </li>" +
    //                     "</ul>" +
    //                     "</div></td>";



    //             rowHtml += "</tr>";

    //             tableBody.append(rowHtml);
    //         });
    //     },
    //     error: function (error) {
    //         console.log(error);
    //     }
    // });

</script>